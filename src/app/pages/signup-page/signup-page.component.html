<h2>SighUp</h2>

<form [formGroup]="registryForm" (ngSubmit)="onSubmit()" [ngClass]="firstContact ? 'active' : null">
  <mat-form-field appearance="outline">
    <mat-label for="email">Email</mat-label>
    <input matInput type="text" id="email" formControlName="email" (keydown)="onClearError()" />
    <mat-error *ngIf="email.hasError('required') && email.dirty && email.touched && firstContact">
      Required</mat-error
    >
    <mat-error
      *ngIf="
        email.errors?.['EmailError'] &&
        email.dirty &&
        email.touched &&
        email.value.length &&
        firstContact
      "
    >
      Incorrect email
    </mat-error>
  </mat-form-field>
  <div [ngClass]="(reason$ | async) === 'invalidUniqueKey' ? 'error' : 'hide'">
    Account with this email already exists
  </div>
  <mat-form-field appearance="outline">
    <mat-label for="password">Password</mat-label>
    <input matInput type="password" id="password" formControlName="password" />
    <mat-error
      *ngIf="password.hasError('required') && password.dirty && password.touched && firstContact"
    >
      Required</mat-error
    >
    <mat-error
      *ngIf="password.value.length < 8 && password.dirty && password.touched && firstContact"
    >
      Password must be at least 8 characters long</mat-error
    >
  </mat-form-field>
  <mat-form-field appearance="outline">
    <mat-label for="repeatPassword">Repeat password</mat-label>
    <input matInput type="password" id="repeatPassword" formControlName="repeatPassword" />
  </mat-form-field>
  <div
    [ngClass]="
      registryForm.errors?.['MatchError'] &&
      repeatPassword.dirty &&
      repeatPassword.touched &&
      firstContact
        ? 'second'
        : 'hide'
    "
  >
    Passwords do not match
  </div>
  <div class="wrapper-button">
    <button
      type="submit"
      mat-flat-button
      [ngStyle]="{ 'min-width.px': 100 }"
      [disabled]="!registryForm.valid || (reason$ | async) === 'invalidUniqueKey'"
    >
      Register
    </button>
    <button type="button" mat-flat-button [ngStyle]="{ 'min-width.px': 100 }" (click)="goSignIn()">
      Sign In
    </button>
  </div>
</form>
