<form [formGroup]="updateForm" (ngSubmit)="onSubmit()">
  <div class="stations" formArrayName="stations">
    <h2>Stations</h2>
    @if (mode === 'update') {
      @for (station of updatePathes; track station; let i = $index) {
        @if (i === 0) {
          <select (change)="changeControls(i, 'station')" [formControlName]="i">
            @for (city of stations$ | async; track city.id) {
              <option [value]="city.id" [defaultSelected]="currentRoute.path[0] === city.id">
                {{ city.city }}
              </option>
            }
          </select>
        } @else {
          <select [formControlName]="i" (change)="changeControls(i, 'station')">
            @for (city of updatePathes[i]; track city.city) {
              <option [value]="city.id" [defaultSelected]="currentRoute.path[i] === city.id">
                {{ city.city }}
              </option>
            }
          </select>
        }
      }
    } @else {
      @for (station of stations.controls; track station; let i = $index) {
        @if (i === 0) {
          <select (change)="changeControls(i, 'station')" [formControlName]="i">
            @for (city of stations$ | async; track city.id) {
              <option [value]="city.id" [defaultSelected]="stations.value[0] === city.id">
                {{ city.city }}
              </option>
            }
          </select>
        } @else {
          <select (change)="changeControls(i, 'station')" [formControlName]="i">
            @for (city of getConnectedCities(stations.value[i - 1]); track city.id) {
              <option [value]="city.id" [defaultSelected]="stations.value[i] === city.id">
                {{ city.city }}
              </option>
            }
          </select>
        }
      }
    }
  </div>
  <div class="carriages" formArrayName="carriages">
    <h2>Carriages</h2>
    @for (carriage of currentRoute.carriages; track carriage + i; let i = $index) {
      <select [formControlName]="i" (change)="changeControls(i, 'carriage')">
        @for (bag of carriages$ | async; track bag.code) {
          <option [value]="bag.name" [defaultSelected]="currentRoute.carriages[i] === bag.name">
            {{ bag.name }}
          </option>
        }
      </select>
    }
  </div>

  <button mat-button type="submit">Save update Route</button>
  <button mat-button (click)="close()">Close</button>
</form>
